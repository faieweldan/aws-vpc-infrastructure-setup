# AWS VPC Setup - CLI Method

This guide walks through creating VPC infrastructure using AWS CloudShell and the AWS CLI.

Prerequisites

- AWS account with IAM admin user
- Access to AWS CloudShell (available in AWS Console)

Step 1: Open CloudShell

1. Log into AWS Console with your IAM admin user
2. Click the CloudShell icon at the top navigation bar
3. Wait for CloudShell environment to initialize (first-time users may wait 1-2 minutes)

Step 2: Create the VPC

```bash
aws ec2 create-vpc --cidr-block 10.0.0.0/16 --query Vpc.VpcId --output text
```

Expected Output: vpc-0573c266b2cd5f340

Command Breakdown:
- aws ec2 uses EC2 service (VPCs originally designed for EC2)
- create-vpc is the action to create new VPC
- --cidr-block 10.0.0.0/16 sets IP address range (65,536 addresses)
- --query Vpc.VpcId filters output to show only VPC ID
- --output text formats as plain text (not JSON)

Step 3: Tag the VPC (Optional but Recommended)

```bash
aws ec2 create-tags --resources=vpc-0573c266b2cd5f340 --tags Key=Name,Value="NextWork VPC 2"
```

Note: Replace vpc-0573c266b2cd5f340 with your actual VPC ID from Step 2.

Common Error:

Wrong - Missing equals sign:
```bash
aws ec2 create-tags --resources-0573c266b2cd5f340 --tags Key=Name,Value="NextWork VPC 2"
```

Correct:
```bash
aws ec2 create-tags --resources=vpc-0573c266b2cd5f340 --tags Key=Name,Value="NextWork VPC 2"
```

Step 4: Create the Subnet

```bash
aws ec2 create-subnet --vpc-id vpc-0573c266b2cd5f340 --cidr-block 10.0.0.0/24
```

Expected Output: Returns JSON with subnet details including SubnetId (subnet-0f1a72c3ff1059544), AvailabilityZone (us-east-1b), CidrBlock (10.0.0.0/24), and VpcId (vpc-0573c266b2cd5f340)

Common Error:

Wrong - Missing CIDR block:
```bash
aws ec2 create-subnet --vpc-id vpc-0573c266b2cd5f340 --cidr-block ADD-CIDR-BLOCK-HERE
```

Error message: InvalidParameterValue - Value (ADD-CIDR-BLOCK-HERE) for parameter cidrBlock is invalid. This is not a valid CIDR block.

Correct:
```bash
aws ec2 create-subnet --vpc-id vpc-0573c266b2cd5f340 --cidr-block 10.0.0.0/24
```

Important: The --cidr-block parameter is required, not optional. AWS needs to know what IP range to assign to the subnet.

Step 5: Create Internet Gateway

```bash
aws ec2 create-internet-gateway --query InternetGateway.InternetGatewayId --output text
```

Expected Output: igw-0d3795341e94a0444

Step 6: Attach Internet Gateway to VPC

```bash
aws ec2 attach-internet-gateway --vpc-id vpc-0573c266b2cd5f340 --internet-gateway-id igw-0d3795341e94a0444
```

Note: Replace IDs with your actual VPC ID and IGW ID from previous steps.

Expected Output: No output means success. The gateway is now attached.

Verification

Verify in Console:

1. Navigate to VPC Console
2. Select Your VPCs - confirm your VPC exists with correct CIDR
3. Select Subnets - confirm subnet with 10.0.0.0/24 range
4. Select Internet Gateways - confirm gateway shows "Attached" status

Verify via CLI:

```bash
# List your VPCs
aws ec2 describe-vpcs --vpc-ids vpc-0573c266b2cd5f340

# List subnets in your VPC
aws ec2 describe-subnets --filters "Name=vpc-id,Values=vpc-0573c266b2cd5f340"

# Verify IGW attachment
aws ec2 describe-internet-gateways --internet-gateway-ids igw-0d3795341e94a0444
```

Cleanup Commands

When done with the infrastructure, delete in this order:

```bash
# 1. Detach internet gateway
aws ec2 detach-internet-gateway --vpc-id vpc-0573c266b2cd5f340 --internet-gateway-id igw-0d3795341e94a0444

# 2. Delete internet gateway
aws ec2 delete-internet-gateway --internet-gateway-id igw-0d3795341e94a0444

# 3. Delete subnet
aws ec2 delete-subnet --subnet-id subnet-0f1a72c3ff1059544

# 4. Delete VPC
aws ec2 delete-vpc --vpc-id vpc-0573c266b2cd5f340
```

Complete Script

Here's all commands together using variables:

```bash
# 1. Create VPC
VPC_ID=$(aws ec2 create-vpc --cidr-block 10.0.0.0/16 --query Vpc.VpcId --output text)
echo "VPC ID: $VPC_ID"

# 2. Tag VPC
aws ec2 create-tags --resources=$VPC_ID --tags Key=Name,Value="NextWork VPC"

# 3. Create Subnet
SUBNET_ID=$(aws ec2 create-subnet --vpc-id $VPC_ID --cidr-block 10.0.0.0/24 --query Subnet.SubnetId --output text)
echo "Subnet ID: $SUBNET_ID"

# 4. Tag Subnet
aws ec2 create-tags --resources=$SUBNET_ID --tags Key=Name,Value="Public 1"

# 5. Enable auto-assign public IP
aws ec2 modify-subnet-attribute --subnet-id $SUBNET_ID --map-public-ip-on-launch

# 6. Create Internet Gateway
IGW_ID=$(aws ec2 create-internet-gateway --query InternetGateway.InternetGatewayId --output text)
echo "IGW ID: $IGW_ID"

# 7. Tag Internet Gateway
aws ec2 create-tags --resources=$IGW_ID --tags Key=Name,Value="NextWork IG"

# 8. Attach Internet Gateway
aws ec2 attach-internet-gateway --vpc-id $VPC_ID --internet-gateway-id $IGW_ID

echo "Setup complete!"
echo "VPC: $VPC_ID"
echo "Subnet: $SUBNET_ID"
echo "IGW: $IGW_ID"
```

Tips

1. Save IDs immediately - Copy VPC ID, Subnet ID, and IGW ID into a text file as you create them
2. Use --query for cleaner output - Filters make it easier to grab IDs without parsing JSON
3. Tag resources early - Easier to identify resources in Console
4. Check AWS region - Ensure CloudShell is in correct region (check top-right of Console)

Advantages of CLI Method

- Speed: Create resources in seconds vs clicking through multiple pages
- Repeatability: Copy/paste commands to recreate infrastructure
- Automation: Can integrate into scripts for DevOps pipelines
- Version Control: Store commands in Git for infrastructure-as-code

When to Use Console Instead

- Learning AWS for the first time (better visualization)
- Complex configurations requiring visual confirmation
- Troubleshooting issues (easier to see resource relationships)
- One-off setups where speed isn't critical

Common Command Options Explained

--query
Filters JSON output to show only specific fields. For example, --query Vpc.VpcId gets VPC ID from output.

--output
Controls output format. Options are text (plain text, easy to save in variables), json (default, most detailed), or table (ASCII table, human-readable).

--filters
Searches resources by specific criteria. For example, --filters "Name=vpc-id,Values=vpc-123" finds by VPC ID.

Region-Specific Commands

If you need to work in a specific region, add --region flag to any command or set default region:

```bash
# Add --region flag
aws ec2 create-vpc --cidr-block 10.0.0.0/16 --region us-west-2

# Or set default region
aws configure set region us-east-1
```
