# AWS VPC Setup - CLI Method

This guide walks through creating VPC infrastructure using AWS CloudShell and the AWS CLI.

## Prerequisites

- AWS account with IAM admin user
- Access to AWS CloudShell (available in AWS Console)

## Step 1: Open CloudShell

1. Log into AWS Console with your IAM admin user
2. Click the CloudShell icon at the top navigation bar
3. Wait for CloudShell environment to initialize (first-time users may wait 1-2 minutes)

## Step 2: Create the VPC

```bash
aws ec2 create-vpc --cidr-block 10.0.0.0/16 --query Vpc.VpcId --output text
```

**Output:** `vpc-0573c266b2cd5f340`

### Command Breakdown:
- `aws ec2` - Uses EC2 service (VPCs originally designed for EC2)
- `create-vpc` - Action to create new VPC
- `--cidr-block 10.0.0.0/16` - IP address range (65,536 addresses)
- `--query Vpc.VpcId` - Filter output to show only VPC ID
- `--output text` - Format as plain text (not JSON)

## Step 3: Tag the VPC (Optional but Recommended)

```bash
aws ec2 create-tags --resources=vpc-0573c266b2cd5f340 --tags Key=Name,Value="NextWork VPC 2"
```

**Note:** Replace `vpc-0573c266b2cd5f340` with your actual VPC ID from Step 2.

### Common Error:
```bash
# ❌ WRONG - Missing equals sign
aws ec2 create-tags --resources-0573c266b2cd5f340 --tags Key=Name,Value="NextWork VPC 2"

# ✅ CORRECT
aws ec2 create-tags --resources=vpc-0573c266b2cd5f340 --tags Key=Name,Value="NextWork VPC 2"
```

## Step 4: Create the Subnet

```bash
aws ec2 create-subnet --vpc-id vpc-0573c266b2cd5f340 --cidr-block 10.0.0.0/24
```

**Output:** Returns JSON with subnet details including:
- `SubnetId`: subnet-0f1a72c3ff1059544
- `AvailabilityZone`: us-east-1b
- `CidrBlock`: 10.0.0.0/24
- `VpcId`: vpc-0573c266b2cd5f340

### Common Error:
```bash
# ❌ WRONG - Missing CIDR block
aws ec2 create-subnet --vpc-id vpc-0573c266b2cd5f340 --cidr-block ADD-CIDR-BLOCK-HERE

# Error: InvalidParameterValue - Value (ADD-CIDR-BLOCK-HERE) for parameter cidrBlock is invalid. This is not a valid CIDR block.

# ✅ CORRECT
aws ec2 create-subnet --vpc-id vpc-0573c266b2cd5f340 --cidr-block 10.0.0.0/24
```

**Important:** The `--cidr-block` parameter is **required**, not optional. AWS needs to know what IP range to assign to the subnet.

## Step 5: Create Internet Gateway

```bash
aws ec2 create-internet-gateway --query InternetGateway.InternetGatewayId --output text
```

**Output:** `igw-0d3795341e94a0444`

## Step 6: Attach Internet Gateway to VPC

```bash
aws ec2 attach-internet-gateway --vpc-id vpc-0573c266b2cd5f340 --internet-gateway-id igw-0d3795341e94a0444
```

**Note:** Replace IDs with your actual VPC ID and IGW ID from previous steps.

**Output:** No output means success! The gateway is now attached.

## Verification

### Verify in Console:

1. Navigate to VPC Console
2. Select "Your VPCs" - confirm your VPC exists with correct CIDR
3. Select "Subnets" - confirm subnet with 10.0.0.0/24 range
4. Select "Internet Gateways" - confirm gateway shows "Attached" status

### Verify via CLI:

```bash
# List your VPCs
aws ec2 describe-vpcs --vpc-ids vpc-0573c266b2cd5f340

# List subnets in your VPC
aws ec2 describe-subnets --filters "Name=vpc-id,Values=vpc-0573c266b2cd5f340"

# Verify IGW attachment
aws ec2 describe-internet-gateways --internet-gateway-ids igw-0d3795341e94a0444
```

## Cleanup Commands

When done with the infrastructure, delete in this order:

```bash
# 1. Detach internet gateway
aws ec2 detach-internet-gateway --vpc-id vpc-0573c266b2cd5f340 --internet-gateway-id igw-0d3795341e94a0444

# 2. Delete internet gateway
aws ec2 delete-internet-gateway --internet-gateway-id igw-0d3795341e94a0444

# 3. Delete subnet
aws ec2 delete-subnet --subnet-id subnet-0f1a72c3ff1059544

# 4. Delete VPC
aws ec2 delete-vpc --vpc-id vpc-0573c266b2cd5f340
```

## Complete Script

See [complete-setup.sh](../scripts/complete-setup.sh) for a ready-to-run script with all commands.

## Tips

1. **Save IDs immediately** - Copy VPC ID, Subnet ID, and IGW ID into a text file as you create them
2. **Use --query for cleaner output** - Filters make it easier to grab IDs without parsing JSON
3. **Tag resources early** - Easier to identify resources in Console
4. **Check AWS region** - Ensure CloudShell is in correct region (check top-right of Console)

## Advantages of CLI Method

- **Speed:** Create resources in seconds vs clicking through multiple pages
- **Repeatability:** Copy/paste commands to recreate infrastructure
- **Automation:** Can integrate into scripts for DevOps pipelines
- **Version Control:** Store commands in Git for infrastructure-as-code

## When to Use Console Instead

- Learning AWS for the first time (better visualization)
- Complex configurations requiring visual confirmation
- Troubleshooting issues (easier to see resource relationships)
- One-off setups where speed isn't critical
